# 削除機能のテスト手順

## 問題の本質

NextAuthのユーザーIDはUUID形式（例: `a1234567-b890-1234-5678-90abcdef1234`）で、MongoDBの投稿IDはObjectId形式（例: `68992778b41942664149e37a`）です。削除時の権限チェックで、`post.author`（UUID形式）と`session.user.id`（UUID形式）を比較する必要があります。

## 修正内容

1. **削除API（`/app/api/posts/[id]/route.ts`）を修正**:
   - String型として両方のIDを比較するように変更
   - デバッグログを追加して実際のID値を確認

2. **投稿作成API（`/app/api/posts/route.ts`）を修正**:
   - 作成時のユーザーID形式をログ出力

## テスト手順

### 1. ブラウザのコンソールを開く

- Chrome/Edgeで: F12キー → Consoleタブ
- 削除操作時のログが表示されます

### 2. 新しい投稿を作成

1. `/board`ページにアクセス
2. 右下の「+」ボタンをクリック
3. タイトルと内容を入力して投稿

### 3. 削除をテスト

1. 作成した投稿の右上の「⋮」メニューをクリック
2. 「削除」を選択
3. 確認ダイアログで「削除する」をクリック

### 4. コンソールログを確認

以下のログが表示されるはずです：

- `削除開始 - 投稿ID: [ObjectId]`
- `選択された投稿: [投稿オブジェクト]`
- `削除API呼び出し: /api/posts/[ObjectId]`
- `削除APIレスポンス status: 200`（成功時）

### 5. サーバーログを確認

ターミナルで以下のようなログが表示されます：

```
削除リクエスト - セッション情報: {
  userId: 'UUID形式のID',
  userEmail: 'ユーザーのメール',
  userName: 'ユーザー名'
}
削除対象の投稿情報: {
  postId: 'ObjectId形式',
  postAuthor: 'UUID形式のID',
  postAuthorType: 'string'
}
権限チェック結果: {
  postAuthor: 'UUID形式',
  sessionUserId: 'UUID形式',
  isAuthor: true
}
削除結果: 成功
```

## 期待される結果

- 削除ボタンをクリック後、投稿が一覧から消える
- ページがリフレッシュされ、削除された投稿が表示されない

## トラブルシューティング

もし削除が失敗する場合：

1. サーバーログで`isAuthor: false`となっていないか確認
2. `postAuthor`と`sessionUserId`が完全に一致しているか確認
3. エラーメッセージ「権限がありません」が表示される場合は、IDの不一致が原因
