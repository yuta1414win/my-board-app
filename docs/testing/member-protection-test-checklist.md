# 会員限定ページ保護システム テストチェックリスト

## 📝 テスト前準備

### 環境セットアップ

- [ ] Node.js バージョンの確認（v18以上推奨）
- [ ] npm install でパッケージをインストール
- [ ] 環境変数の設定確認（.env.local）
- [ ] データベースの接続確認
- [ ] 開発サーバーの起動 `npm run dev`
- [ ] テストユーザーアカウントの準備

### ブラウザ準備

- [ ] Chrome, Firefox, Safari, Edge でのテスト準備
- [ ] 開発者ツールの開放（Network, Console タブ）
- [ ] シークレット/プライベートモードでの実行準備

---

## 🔒 1. 基本認証フローテスト

### 1.1 未ログイン状態でのアクセス制御

#### ダッシュボード (`/dashboard`)

- [ ] **アクセステスト**: 未ログインで `/dashboard` にアクセス
  - [ ] ログインページ (`/auth/login`) にリダイレクト
  - [ ] URL に `callbackUrl=%2Fdashboard` が含まれる
  - [ ] ダッシュボードのコンテンツが表示されない

#### プロフィール (`/profile`)

- [ ] **アクセステスト**: 未ログインで `/profile` にアクセス
  - [ ] ログインページにリダイレクト
  - [ ] URL に `callbackUrl=%2Fprofile` が含まれる

#### 投稿作成 (`/posts/new`)

- [ ] **アクセステスト**: 未ログインで `/posts/new` にアクセス
  - [ ] ログインページにリダイレクト
  - [ ] URL に `callbackUrl=%2Fposts%2Fnew` が含まれる

#### 投稿編集 (`/posts/[id]/edit`)

- [ ] **アクセステスト**: 未ログインで `/posts/123/edit` にアクセス
  - [ ] ログインページにリダイレクト
  - [ ] 正しい callbackURL が設定される

### 1.2 ログイン後の復帰フロー

- [ ] **テストケース 1**: ダッシュボードアクセス → ログイン → 復帰
  - [ ] `/dashboard` アクセス → ログインページ遷移
  - [ ] 有効認証情報でログイン実行
  - [ ] ログイン成功後、`/dashboard` に自動遷移
  - [ ] ダッシュボードのコンテンツが正常表示

- [ ] **テストケース 2**: プロフィールアクセス → ログイン → 復帰
  - [ ] 同様のフローで `/profile` への復帰確認

- [ ] **テストケース 3**: 投稿作成アクセス → ログイン → 復帰
  - [ ] 同様のフローで `/posts/new` への復帰確認

### 1.3 ログイン済み時の認証ページアクセス制御

- [ ] **テストケース**: ログイン済み状態で認証ページアクセス
  - [ ] 有効アカウントでログイン完了
  - [ ] `/auth/login` にアクセス → `/board` にリダイレクト
  - [ ] `/auth/signin` にアクセス → `/board` にリダイレクト
  - [ ] `/auth/register` にアクセス → `/board` にリダイレクト

---

## 📱 2. ページ機能テスト

### 2.1 ダッシュボードページ (`/dashboard`)

#### 基本表示確認

- [ ] **ヘッダーセクション**
  - [ ] 「ダッシュボード」タイトル表示
  - [ ] ユーザー名表示: `おかえりなさい、{ユーザー名}さん`
  - [ ] ユーザーのメールアドレス表示
  - [ ] プロフィール画像/アバター表示
  - [ ] 「メンバー」チップ表示

#### クイックアクションカード

- [ ] **新規投稿カード**
  - [ ] アイコンと「新規投稿」ラベル表示
  - [ ] 「投稿作成」ボタンクリック → `/posts/new` に遷移

- [ ] **掲示板カード**
  - [ ] アイコンと「掲示板」ラベル表示
  - [ ] 「掲示板を見る」ボタンクリック → `/board` に遷移

- [ ] **プロフィールカード**
  - [ ] アイコンと「プロフィール」ラベル表示
  - [ ] 「プロフィール」ボタンクリック → `/profile` に遷移

- [ ] **設定カード**
  - [ ] アイコンと「設定」ラベル表示
  - [ ] 「設定」ボタンクリック → `/settings` に遷移

#### 統計・アクティビティセクション

- [ ] **統計セクション**
  - [ ] 「統計」タイトル表示
  - [ ] 「総投稿数」と数値表示
  - [ ] 「総コメント数」と数値表示
  - [ ] 「メンバー歴」と期間表示

- [ ] **最近のアクティビティセクション**
  - [ ] 「最近のアクティビティ」タイトル表示
  - [ ] アクティビティ項目の表示
  - [ ] 日付と内容の表示

- [ ] **通知セクション**
  - [ ] 「通知」タイトル表示
  - [ ] 通知内容または「新しい通知はありません」表示

### 2.2 プロフィールページ (`/profile`)

#### 基本表示確認

- [ ] **ページヘッダー**
  - [ ] 「プロフィール」タイトル表示
  - [ ] プロフィール基本情報セクション表示

#### アバター・ユーザー情報表示

- [ ] **アバターセクション**
  - [ ] プロフィール画像/アバター表示
  - [ ] ユーザー名表示
  - [ ] 「メンバー」ステータス表示
  - [ ] カメラアイコン（将来の機能用）

#### 基本情報セクション

- [ ] **表示モード（編集前）**
  - [ ] 「基本情報」タイトル表示
  - [ ] 「編集」ボタン表示
  - [ ] 名前の表示（未設定時：「未設定」）
  - [ ] 自己紹介の表示（未設定時：「自己紹介が設定されていません。」）

#### 編集モード

- [ ] **編集モード切り替え**
  - [ ] 「編集」ボタンクリック → 編集モードに切り替わる
  - [ ] 「保存」「キャンセル」ボタン表示
  - [ ] 名前入力フィールド表示（現在値が初期値）
  - [ ] 自己紹介テキストエリア表示（現在値が初期値）

- [ ] **フォーム入力機能**
  - [ ] 名前フィールドへの文字入力
  - [ ] 自己紹介フィールドへの文字入力（改行対応）
  - [ ] 入力内容のリアルタイム反映

- [ ] **バリデーション**
  - [ ] 名前が空の状態で保存 → エラーメッセージ表示
  - [ ] 名前50文字超過時 → エラーメッセージ表示
  - [ ] 自己紹介500文字超過時 → エラーメッセージ表示

#### 保存・キャンセル機能

- [ ] **保存処理**
  - [ ] 有効データで「保存」クリック
  - [ ] ローディング状態表示（プログレスバー）
  - [ ] 「プロフィールを更新しました」成功メッセージ
  - [ ] 編集モード終了 → 表示モードに切り替わり
  - [ ] 更新内容の反映確認

- [ ] **キャンセル処理**
  - [ ] 変更なしで「キャンセル」→ 即座に表示モードに復帰
  - [ ] 変更ありで「キャンセル」→ 確認なしで元の値に復帰
  - [ ] フォーム内容がリセットされることを確認

#### アカウント情報サイドバー

- [ ] **アカウント情報表示**
  - [ ] メールアドレス表示
  - [ ] 登録日表示（日本語形式）
  - [ ] メール確認状態（確認済み/未確認）
  - [ ] 適切なステータスチップ表示

### 2.3 投稿作成ページ (`/posts/new`)

#### 基本表示確認

- [ ] **ページヘッダー**
  - [ ] 「新規投稿」タイトルとアイコン表示
  - [ ] 投稿者情報セクション（現在のユーザー名）

#### フォーム要素

- [ ] **カテゴリー選択**
  - [ ] ドロップダウンメニュー表示
  - [ ] 選択肢：一般、質問、ディスカッション、お知らせ、テクノロジー、趣味
  - [ ] デフォルト値：「一般」

- [ ] **タイトル入力**
  - [ ] テキストフィールド表示
  - [ ] プレースホルダー表示
  - [ ] 文字数カウンター（0/100文字）
  - [ ] リアルタイムでの文字数更新

- [ ] **本文入力**
  - [ ] 多行テキストエリア表示（12行）
  - [ ] プレースホルダー表示
  - [ ] 文字数カウンター（0/5000文字）
  - [ ] リアルタイムでの文字数更新

#### プレビュー機能

- [ ] **プレビュー表示**
  - [ ] 「プレビュー」ボタンクリック
  - [ ] プレビューエリア表示
  - [ ] タイトル・カテゴリー・本文の表示確認
  - [ ] 改行の正しい反映
  - [ ] 「プレビュー終了」ボタンでプレビュー非表示

#### バリデーション

- [ ] **必須フィールドチェック**
  - [ ] タイトル空白時 → エラーメッセージ「タイトルを入力してください」
  - [ ] 本文空白時 → エラーメッセージ「本文を入力してください」
  - [ ] 両方空白時 → 投稿ボタン無効化

- [ ] **文字数制限チェック**
  - [ ] タイトル100文字超過時 → エラーメッセージ
  - [ ] 本文5000文字超過時 → エラーメッセージ

#### 投稿・キャンセル処理

- [ ] **投稿処理**
  - [ ] 有効データで「投稿する」クリック
  - [ ] ローディング状態「投稿中...」表示
  - [ ] 投稿成功後、掲示板へリダイレクト（成功メッセージ付き）

- [ ] **キャンセル処理**
  - [ ] 入力なしで「キャンセル」→ 即座に前ページに戻る
  - [ ] 入力ありで「キャンセル」→ 確認ダイアログ表示

#### ヒントセクション

- [ ] **投稿のヒント表示**
  - [ ] ヒントボックスの表示
  - [ ] 投稿のガイドライン表示

### 2.4 投稿編集ページ (`/posts/[id]/edit`)

#### 基本表示確認・権限チェック

- [ ] **有効な自分の投稿**
  - [ ] 投稿データの正常読み込み
  - [ ] 「投稿編集」タイトル表示
  - [ ] フォームに既存データが初期値として設定

- [ ] **他人の投稿アクセス**
  - [ ] 「アクセスできません」エラーメッセージ
  - [ ] 「この投稿を編集する権限がありません」メッセージ
  - [ ] 「掲示板に戻る」ボタン表示

- [ ] **存在しない投稿ID**
  - [ ] 「エラーが発生しました」メッセージ
  - [ ] 「投稿が見つかりません」または適切なエラーメッセージ
  - [ ] 「戻る」ボタン表示

#### 投稿情報表示

- [ ] **投稿メタデータ**
  - [ ] 投稿者名表示
  - [ ] 作成日時表示（日本語形式）
  - [ ] 最終更新日時表示（更新されている場合）

#### 編集機能（投稿作成と同様）

- [ ] **フォーム機能**
  - [ ] カテゴリー選択（現在値が選択済み）
  - [ ] タイトル編集（現在値が初期値）
  - [ ] 本文編集（現在値が初期値）
  - [ ] 文字数カウンター機能
  - [ ] プレビュー機能

- [ ] **バリデーション**
  - [ ] 投稿作成と同じバリデーションルール
  - [ ] エラーメッセージの適切な表示

#### 更新・削除処理

- [ ] **更新処理**
  - [ ] 「更新する」ボタンクリック
  - [ ] ローディング状態「更新中...」表示
  - [ ] 更新成功後、掲示板へリダイレクト（成功メッセージ付き）

- [ ] **削除処理**
  - [ ] 「削除」ボタンクリック（初回）
  - [ ] 「本当に削除」ボタン表示（確認）
  - [ ] 再度クリックで削除実行
  - [ ] 削除成功後、掲示板へリダイレクト

- [ ] **キャンセル処理**
  - [ ] 変更なしで「キャンセル」→ 即座に前ページ
  - [ ] 変更ありで「キャンセル」→ 確認ダイアログ

---

## 🔌 3. API認証テスト

### 3.1 プロフィールAPI (`/api/user/profile`)

#### GET リクエスト

- [ ] **未認証リクエスト**

  ```bash
  curl -X GET http://localhost:3000/api/user/profile
  ```

  - [ ] ステータスコード: 401
  - [ ] エラーメッセージ: "認証が必要です"

- [ ] **認証済みリクエスト**
  - [ ] ログイン後のセッションCookieでリクエスト
  - [ ] ステータスコード: 200
  - [ ] ユーザー情報が正しく返される

#### PUT リクエスト

- [ ] **未認証リクエスト**
  - [ ] ステータスコード: 401
  - [ ] エラーメッセージ: "認証が必要です"

- [ ] **バリデーションテスト（認証済み）**
  - [ ] 名前空白 → 400エラー「名前は必須です」
  - [ ] 名前51文字 → 400エラー「名前は50文字以内で入力してください」
  - [ ] 自己紹介501文字 → 400エラー「自己紹介は500文字以内で入力してください」
  - [ ] 有効データ → 200成功、更新されたデータが返される

### 3.2 投稿API (`/api/posts`)

#### GET リクエスト

- [ ] **未認証リクエスト**
  - [ ] ステータスコード: 401
  - [ ] エラーメッセージ: "認証が必要です"

- [ ] **認証済みリクエスト**
  - [ ] ステータスコード: 200
  - [ ] 投稿一覧とページネーション情報が返される

#### POST リクエスト

- [ ] **未認証リクエスト**
  - [ ] ステータスコード: 401
  - [ ] エラーメッセージ: "認証が必要です"

- [ ] **バリデーションテスト（認証済み）**
  - [ ] タイトル空白 → 400エラー「タイトルと内容は必須です」
  - [ ] 内容空白 → 400エラー「タイトルと内容は必須です」
  - [ ] タイトル101文字 → 400エラー「タイトルは100文字以内で入力してください」
  - [ ] 内容5001文字 → 400エラー「内容は5000文字以内で入力してください」
  - [ ] 無効カテゴリー → 400エラー「無効なカテゴリーです」
  - [ ] 有効データ → 201成功、作成された投稿が返される

### 3.3 投稿個別API (`/api/posts/[id]`)

#### GET リクエスト

- [ ] **未認証リクエスト**
  - [ ] ステータスコード: 401

- [ ] **存在しない投稿ID**
  - [ ] ステータスコード: 404
  - [ ] エラーメッセージ: "投稿が見つかりません"

#### PUT リクエスト（更新）

- [ ] **未認証リクエスト**
  - [ ] ステータスコード: 401

- [ ] **他人の投稿更新**
  - [ ] ステータスコード: 403
  - [ ] エラーメッセージ: "権限がありません"

- [ ] **自分の投稿更新**
  - [ ] 有効データ → 200成功、更新後のデータ
  - [ ] バリデーションエラー → 適切な400エラー

#### DELETE リクエスト（削除）

- [ ] **未認証リクエスト**
  - [ ] ステータスコード: 401

- [ ] **他人の投稿削除**
  - [ ] ステータスコード: 403
  - [ ] エラーメッセージ: "権限がありません"

- [ ] **自分の投稿削除**
  - [ ] ステータスコード: 200
  - [ ] 成功メッセージ: "投稿が削除されました"

---

## 🎯 4. エラーハンドリングテスト

### 4.1 ネットワークエラー処理

#### オフライン状態テスト

- [ ] **設定**: 開発者ツール > Network > Offline にチェック
- [ ] **各ページでのテスト**
  - [ ] ダッシュボードアクセス → 適切なエラーメッセージ
  - [ ] プロフィール保存 → エラーメッセージと操作可能状態復帰
  - [ ] 投稿作成 → エラーメッセージと操作可能状態復帰

#### 低速ネットワークテスト

- [ ] **設定**: 開発者ツール > Network > Slow 3G
- [ ] **ローディング状態確認**
  - [ ] ページローディング時のプログレスバー
  - [ ] フォーム送信時のローディング状態
  - [ ] ボタンの適切な無効化
  - [ ] 「読み込み中...」「送信中...」メッセージ

### 4.2 サーバーエラー処理

#### 500 Internal Server Error

- [ ] **サーバー側でエラーを発生させる**
  - [ ] 適切なエラーメッセージ表示
  - [ ] ユーザーが操作を継続できる状態
  - [ ] エラー状態からの回復

#### 404 Not Found

- [ ] **存在しない投稿編集ページ**
  - [ ] `/posts/nonexistent-id/edit` アクセス
  - [ ] 「投稿が見つかりません」メッセージ
  - [ ] 「戻る」ボタンで適切な遷移

### 4.3 セッションエラー処理

#### セッション期限切れ

- [ ] **セッション削除後のAPI呼び出し**
  - [ ] セッションCookieを手動削除
  - [ ] プロフィール更新試行 → 認証エラー
  - [ ] ログインページへの適切な誘導

---

## 📱 5. レスポンシブデザインテスト

### 5.1 ブレークポイントテスト

#### モバイル（375px × 667px）

- [ ] **ダッシュボード**
  - [ ] カード要素の縦並び表示
  - [ ] タッチフレンドリーなボタンサイズ
  - [ ] スクロール動作の確認

- [ ] **プロフィール**
  - [ ] フォーム要素の適切な配置
  - [ ] モバイルキーボード表示時の動作

- [ ] **投稿作成・編集**
  - [ ] テキストエリアの適切なサイズ
  - [ ] ボタンの適切な配置とサイズ

#### タブレット（768px × 1024px）

- [ ] **レイアウト調整**
  - [ ] 2列表示への適切な変更
  - [ ] サイドバーとメインコンテンツの配置

#### デスクトップ（1024px+）

- [ ] **フル機能表示**
  - [ ] すべての要素の適切な表示
  - [ ] ホバーエフェクトの動作確認

### 5.2 タッチデバイス対応

- [ ] **タッチ操作**
  - [ ] タップでのボタン操作
  - [ ] フォーム入力時のキーボード表示
  - [ ] スクロール動作の確認

---

## 🌐 6. ブラウザ互換性テスト

### 6.1 主要ブラウザテスト

#### Chrome（最新版）

- [ ] **基本機能**
  - [ ] 認証フロー動作
  - [ ] ページ表示・操作
  - [ ] API通信

#### Firefox（最新版）

- [ ] **基本機能**
  - [ ] 認証フロー動作
  - [ ] ページ表示・操作
  - [ ] API通信

#### Safari（最新版）

- [ ] **基本機能**
  - [ ] 認証フロー動作
  - [ ] ページ表示・操作
  - [ ] API通信

#### Edge（最新版）

- [ ] **基本機能**
  - [ ] 認証フロー動作
  - [ ] ページ表示・操作
  - [ ] API通信

### 6.2 ブラウザ固有機能

- [ ] **Cookie動作**
  - [ ] セッション管理の正常動作
  - [ ] ログイン状態の保持

- [ ] **JavaScript機能**
  - [ ] ES6+機能の動作確認
  - [ ] Async/await の正常動作

---

## ⚡ 7. パフォーマンステスト

### 7.1 ページロード性能

#### Core Web Vitals

- [ ] **LCP (Largest Contentful Paint)**
  - [ ] 目標: 2.5秒以下
  - [ ] 各保護ページでの測定

- [ ] **FID (First Input Delay)**
  - [ ] 目標: 100ms以下
  - [ ] ボタンクリック等の応答性

- [ ] **CLS (Cumulative Layout Shift)**
  - [ ] 目標: 0.1以下
  - [ ] レイアウト変更の最小化

#### Lighthouse テスト

- [ ] **Performance Score**
  - [ ] 目標: 80点以上
  - [ ] `/dashboard`, `/profile`, `/posts/new` で測定

### 7.2 ネットワーク性能

- [ ] **API応答時間**
  - [ ] プロフィール取得: 200ms以下
  - [ ] 投稿作成: 500ms以下
  - [ ] 投稿更新: 300ms以下

---

## 🔐 8. セキュリティテスト

### 8.1 認証・認可テスト

- [ ] **セッション管理**
  - [ ] セッションCookieの適切な設定
  - [ ] セッション固定攻撃への対策
  - [ ] セッション期限切れの適切な処理

- [ ] **CSRF対策**
  - [ ] CSRFトークンの実装確認
  - [ ] 外部サイトからの不正リクエスト防止

### 8.2 入力値検証

- [ ] **XSS対策**
  - [ ] HTMLエスケープの実装確認
  - [ ] スクリプト注入攻撃への対策

- [ ] **SQLインジェクション対策**
  - [ ] パラメータ化クエリの使用確認
  - [ ] 不正SQL文の実行防止

### 8.3 権限制御

- [ ] **水平権限昇格**
  - [ ] 他のユーザーのデータへの不正アクセス防止
  - [ ] URL直接アクセスでの権限チェック

- [ ] **垂直権限昇格**
  - [ ] 管理者機能への不正アクセス防止

---

## 📊 9. ユーザビリティテスト

### 9.1 ナビゲーション

- [ ] **直感的な操作**
  - [ ] メニューの分かりやすさ
  - [ ] パンくずナビゲーションの確認

- [ ] **エラー回復**
  - [ ] エラー時の適切な誘導
  - [ ] 操作の取り消し・やり直し

### 9.2 アクセシビリティ

- [ ] **スクリーンリーダー対応**
  - [ ] 適切なaria-label設定
  - [ ] セマンティックなHTML構造

- [ ] **キーボード操作**
  - [ ] Tabキーでの適切なフォーカス移動
  - [ ] Enterキーでの操作実行

---

## ✅ 10. テスト完了チェック

### 10.1 自動テスト実行

- [ ] **単体テスト（API）**

  ```bash
  npm test __tests__/api/auth-protected-api.test.ts
  ```

- [ ] **E2Eテスト**
  ```bash
  npx playwright test tests/e2e/auth/member-page-protection.spec.ts
  ```

### 10.2 総合テストスクリプト

- [ ] **包括テスト実行**
  ```bash
  ./scripts/run-member-protection-tests.sh
  ```

### 10.3 テスト結果の確認

- [ ] **全テストの成功確認**
- [ ] **テストレポートの生成確認**
- [ ] **カバレッジレポートの確認**

---

## 📋 テスト結果記録

### 実行情報

- **実行日時**: ******\_\_\_******
- **実行者**: ******\_\_\_******
- **環境**: ******\_\_\_******
- **ブラウザ**: ******\_\_\_******

### 結果サマリー

- **総テストケース数**: **\_**
- **成功**: **\_** 件
- **失敗**: **\_** 件
- **スキップ**: **\_** 件

### 主要な問題・改善点

```
1.

2.

3.
```

### 次回テスト時の注意点

```
1.

2.

3.
```
