# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¬ã‚¤ãƒ‰

ã“ã®ã‚¬ã‚¤ãƒ‰ã§ã¯ã€å®Ÿè£…ã—ãŸã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã®åŒ…æ‹¬çš„ãªãƒ†ã‚¹ãƒˆæ‰‹é †ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

## ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### 1. äº‹å‰æº–å‚™
```bash
# ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install

# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•
npm run dev
```

### 2. åŸºæœ¬ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
```bash
# å…¨è‡ªå‹•ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
./scripts/run-security-tests.sh

# ã¾ãŸã¯å€‹åˆ¥ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
node scripts/security-test.js
```

## ğŸ“‹ ãƒ†ã‚¹ãƒˆé …ç›®ä¸€è¦§

| ãƒ†ã‚¹ãƒˆé …ç›® | è‡ªå‹•ãƒ†ã‚¹ãƒˆ | æ‰‹å‹•ãƒ†ã‚¹ãƒˆ | ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ |
|------------|------------|------------|------------------|
| ğŸš¦ ãƒ¬ãƒ¼ãƒˆåˆ¶é™ | âœ… | âœ… | 1åˆ†5å›åˆ¶é™ã®å‹•ä½œ |
| ğŸ§¹ XSSå¯¾ç­– | âœ… | âœ… | 15ç¨®é¡ã®ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰é˜²å¾¡ |
| ğŸ” CSRFå¯¾ç­– | âœ… | âœ… | ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼æ©Ÿèƒ½ |
| ğŸ›¡ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ | âœ… | âœ… | å¿…é ˆãƒ˜ãƒƒãƒ€ãƒ¼è¨­å®šç¢ºèª |
| ğŸ” å…¥åŠ›å€¤æ¤œè¨¼ | âœ… | âœ… | ä¸æ­£å…¥åŠ›ã®æ‹’å¦ |
| ğŸ“Š ç›£æŸ»ãƒ­ã‚° | âœ… | âœ… | ã‚¤ãƒ™ãƒ³ãƒˆè¨˜éŒ²ç¢ºèª |

## ğŸ”§ ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬çš„ãªä½¿ç”¨æ³•

```bash
# å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
./scripts/run-security-tests.sh

# ã‚¯ã‚¤ãƒƒã‚¯ãƒ†ã‚¹ãƒˆï¼ˆæœ€å°é™ï¼‰
./scripts/run-security-tests.sh --quick

# ç‰¹å®šãƒ†ã‚¹ãƒˆã®ã¿å®Ÿè¡Œ
./scripts/run-security-tests.sh -t headers
./scripts/run-security-tests.sh -t xss
./scripts/run-security-tests.sh -t csrf

# è©³ç´°ãƒ­ã‚°ä»˜ãã§å®Ÿè¡Œ
./scripts/run-security-tests.sh --verbose

# ãƒ¬ãƒãƒ¼ãƒˆå‡ºåŠ›ä»˜ãã§å®Ÿè¡Œ
./scripts/run-security-tests.sh --report
```

### ç’°å¢ƒåˆ¥ãƒ†ã‚¹ãƒˆ

```bash
# é–‹ç™ºç’°å¢ƒãƒ†ã‚¹ãƒˆ
./scripts/run-security-tests.sh --dev

# æœ¬ç•ªç’°å¢ƒå‘ã‘ãƒ†ã‚¹ãƒˆ
./scripts/run-security-tests.sh --prod --url https://your-domain.com

# ç‰¹å®šURLã§ã®ãƒ†ã‚¹ãƒˆ
./scripts/run-security-tests.sh -u http://staging.example.com
```

### Node.jsã‚¹ã‚¯ãƒªãƒ—ãƒˆç›´æ¥å®Ÿè¡Œ

```bash
# å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
node scripts/security-test.js

# ç‰¹å®šãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
node scripts/security-test.js rate-limit
node scripts/security-test.js xss
node scripts/security-test.js csrf
node scripts/security-test.js headers
node scripts/security-test.js input
node scripts/security-test.js audit
node scripts/security-test.js overall
```

## ğŸ§ª æ‰‹å‹•ãƒ†ã‚¹ãƒˆæ‰‹é †

è©³ç´°ãªæ‰‹å‹•ãƒ†ã‚¹ãƒˆæ‰‹é †ã«ã¤ã„ã¦ã¯ã€[æ‰‹å‹•ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆæ‰‹é †æ›¸](../scripts/manual-security-test.md)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### ä¸»è¦ãªæ‰‹å‹•ãƒ†ã‚¹ãƒˆãƒã‚¤ãƒ³ãƒˆ

#### 1. ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãƒ†ã‚¹ãƒˆ
```bash
# 10å›ä¸¦è¡Œãƒªã‚¯ã‚¨ã‚¹ãƒˆ
for i in {1..10}; do
  curl -X POST http://localhost:3001/api/posts \
    -H "Content-Type: application/json" \
    -d '{"title":"Test","content":"Rate limit test"}' &
done
wait
```

#### 2. XSSæ”»æ’ƒã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
```html
<!-- æŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ ã«å…¥åŠ›ã—ã¦ãƒ†ã‚¹ãƒˆ -->
<script>alert('XSS')</script>
<img src="x" onerror="alert('XSS')">
<svg onload="alert('XSS')">
```

#### 3. CSRFæ”»æ’ƒãƒ†ã‚¹ãƒˆ
```bash
# CSRFãƒˆãƒ¼ã‚¯ãƒ³ãªã—ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
curl -X POST http://localhost:3001/api/posts \
  -H "Content-Type: application/json" \
  -H "Origin: https://malicious-site.com" \
  -d '{"title":"CSRF Test","content":"Attack"}'
```

## ğŸ“Š ãƒ†ã‚¹ãƒˆçµæœã®è§£é‡ˆ

### æˆåŠŸåŸºæº–

| ãƒ†ã‚¹ãƒˆé …ç›® | æˆåŠŸåŸºæº– | åˆ¤å®š |
|------------|----------|------|
| ãƒ¬ãƒ¼ãƒˆåˆ¶é™ | 90%ä»¥ä¸Šã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒ–ãƒ­ãƒƒã‚¯ | âœ… åˆæ ¼ / âŒ ä¸åˆæ ¼ |
| XSSå¯¾ç­– | 100%ã®ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’ãƒ–ãƒ­ãƒƒã‚¯ | âœ… åˆæ ¼ / âŒ ä¸åˆæ ¼ |
| CSRFå¯¾ç­– | ä¸æ­£ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’100%ãƒ–ãƒ­ãƒƒã‚¯ | âœ… åˆæ ¼ / âŒ ä¸åˆæ ¼ |
| ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ | å¿…é ˆãƒ˜ãƒƒãƒ€ãƒ¼100%è¨­å®š | âœ… åˆæ ¼ / âŒ ä¸åˆæ ¼ |
| å…¥åŠ›æ¤œè¨¼ | 80%ä»¥ä¸Šã®ä¸æ­£å…¥åŠ›ã‚’ãƒ–ãƒ­ãƒƒã‚¯ | âœ… åˆæ ¼ / âŒ ä¸åˆæ ¼ |
| ç›£æŸ»ãƒ­ã‚° | å…¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¨˜éŒ² | âœ… åˆæ ¼ / âŒ ä¸åˆæ ¼ |

### ãƒ†ã‚¹ãƒˆçµæœä¾‹

```bash
ğŸ“Š ãƒ†ã‚¹ãƒˆçµæœã‚µãƒãƒªãƒ¼
âœ… æˆåŠŸ: 6
ğŸ“‹ å¤±æ•—: 0
ğŸ“‹ æˆåŠŸç‡: 100%

ğŸ“‹ è©³ç´°çµæœ:
âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ç¢ºèªãƒ†ã‚¹ãƒˆ: OK (245ms)
âœ… ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãƒ†ã‚¹ãƒˆ: 3æˆåŠŸ, 7ãƒ–ãƒ­ãƒƒã‚¯ - ãƒ¬ãƒ¼ãƒˆåˆ¶é™æ­£å¸¸å‹•ä½œ (1245ms)
âœ… XSSæ”»æ’ƒé˜²å¾¡ãƒ†ã‚¹ãƒˆ: 15å€‹ã®XSSãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’æ­£å¸¸ã«ãƒ–ãƒ­ãƒƒã‚¯ (890ms)
âœ… CSRFæ”»æ’ƒé˜²å¾¡ãƒ†ã‚¹ãƒˆ: CSRFãƒˆãƒ¼ã‚¯ãƒ³ä¸æ­£ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ (156ms)
âœ… ä¸æ­£å…¥åŠ›å€¤æ‹’å¦ãƒ†ã‚¹ãƒˆ: 85.7%ã®ä¸æ­£å…¥åŠ›ã‚’ãƒ–ãƒ­ãƒƒã‚¯ (12/14) (2340ms)
âœ… ç›£æŸ»ãƒ­ã‚°è¨˜éŒ²ç¢ºèªãƒ†ã‚¹ãƒˆ: ãƒ†ã‚¹ãƒˆã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ã¾ã—ãŸï¼ˆãƒ­ã‚°ç¢ºèªAPIã¯åˆ©ç”¨ä¸å¯ï¼‰ (2124ms)
âœ… ç·åˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ: åŸºæœ¬çš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ã‚’ãƒ‘ã‚¹ (567ms)
```

## ğŸ” ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•

#### 1. ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã§ããªã„
```bash
[ERROR] ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã§ãã¾ã›ã‚“: http://localhost:3001
```

**è§£æ±ºæ–¹æ³•:**
- é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèª: `npm run dev`
- ãƒãƒ¼ãƒˆç•ªå·ãŒæ­£ã—ã„ã‹ç¢ºèª
- ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«è¨­å®šã®ç¢ºèª

#### 2. ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã™ã‚‹
```bash
âŒ ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãƒ†ã‚¹ãƒˆ: ã™ã¹ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒæˆåŠŸ - ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãŒæ©Ÿèƒ½ã—ã¦ã„ãªã„å¯èƒ½æ€§
```

**è§£æ±ºæ–¹æ³•:**
- `src/middleware.ts`ã®è¨­å®šç¢ºèª
- LRUã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®åˆæœŸåŒ–ç¢ºèª
- IPã‚¢ãƒ‰ãƒ¬ã‚¹å–å¾—ã®å‹•ä½œç¢ºèª

#### 3. CSRFä¿è­·ãŒå‹•ä½œã—ãªã„
```bash
âŒ CSRFæ”»æ’ƒé˜²å¾¡ãƒ†ã‚¹ãƒˆ: CSRFæ”»æ’ƒãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ (Status: 200)
```

**è§£æ±ºæ–¹æ³•:**
- NextAuthè¨­å®šã®ç¢ºèª
- middleware.tsã§ã®CSRFä¿è­·ç¢ºèª
- ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®è¨­å®šç¢ºèª

### ãƒ‡ãƒãƒƒã‚°æ‰‹æ³•

#### 1. è©³ç´°ãƒ­ã‚°ã®æœ‰åŠ¹åŒ–
```bash
# è©³ç´°ãƒ­ã‚°ä»˜ãã§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
./scripts/run-security-tests.sh --verbose

# ç’°å¢ƒå¤‰æ•°ã§ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰
DEBUG=1 node scripts/security-test.js
```

#### 2. å€‹åˆ¥ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
```bash
# å•é¡Œã®ã‚ã‚‹ãƒ†ã‚¹ãƒˆã®ã¿å®Ÿè¡Œ
node scripts/security-test.js rate-limit
```

#### 3. ãƒ–ãƒ©ã‚¦ã‚¶é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«
- Network ã‚¿ãƒ–ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ç¢ºèª
- Console ã‚¿ãƒ–ã§JavaScriptã‚¨ãƒ©ãƒ¼ç¢ºèª
- Security ã‚¿ãƒ–ã§TLSè¨­å®šç¢ºèª

#### 4. curlã§ã®è©³ç´°ç¢ºèª
```bash
# è©³ç´°ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ç¢ºèª
curl -v -X POST http://localhost:3001/api/posts \
  -H "Content-Type: application/json" \
  -d '{"title":"Test","content":"content"}'
```

## ğŸ“ˆ ç¶™ç¶šçš„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£è¦–

### å®šæœŸå®Ÿè¡Œã®è¨­å®š

#### crontabã§ã®è‡ªå‹•å®Ÿè¡Œ
```bash
# crontab -e ã§ç·¨é›†
# æ¯æ—¥åˆå‰2æ™‚ã«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
0 2 * * * cd /path/to/project && ./scripts/run-security-tests.sh --report >> /var/log/security-test.log 2>&1

# æ¯é€±æœˆæ›œæ—¥ã«åŒ…æ‹¬ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ  
0 3 * * 1 cd /path/to/project && ./scripts/run-security-tests.sh --prod --report
```

#### GitHub Actionsã§ã®è‡ªå‹•å®Ÿè¡Œ
```yaml
# .github/workflows/security-test.yml
name: Security Tests
on:
  schedule:
    - cron: '0 2 * * *'  # æ¯æ—¥åˆå‰2æ™‚
  push:
    branches: [ main ]
    
jobs:
  security-tests:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: actions/setup-node@v2
      with:
        node-version: '18'
    - run: npm ci
    - run: npm run build
    - run: npm start &
    - run: ./scripts/run-security-tests.sh --report
```

### ç›£è¦–ãƒ¡ãƒˆãƒªã‚¯ã‚¹

ä»¥ä¸‹ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’ç¶™ç¶šçš„ã«ç›£è¦–ã—ã¾ã™ï¼š

- **ãƒ†ã‚¹ãƒˆæˆåŠŸç‡**: 95%ä»¥ä¸Šã‚’ç¶­æŒ
- **ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“**: å„ãƒ†ã‚¹ãƒˆ2ç§’ä»¥å†…
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆæ•°**: ç›£æŸ»ãƒ­ã‚°ã§è¿½è·¡
- **è„†å¼±æ€§ã‚¹ã‚³ã‚¢**: å¤–éƒ¨ã‚¹ã‚­ãƒ£ãƒ³ãƒ„ãƒ¼ãƒ«ã§ã®è©•ä¾¡

### ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š

é‡è¦ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã«ã‚¢ãƒ©ãƒ¼ãƒˆã‚’è¨­å®šï¼š

- ãƒ†ã‚¹ãƒˆæˆåŠŸç‡ãŒ90%ã‚’ä¸‹å›ã£ãŸå ´åˆ
- æ–°ã—ã„è„†å¼±æ€§ãŒæ¤œå‡ºã•ã‚ŒãŸå ´åˆ
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆãŒæ€¥å¢—ã—ãŸå ´åˆ
- å¤–éƒ¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³ã§å•é¡ŒãŒæ¤œå‡ºã•ã‚ŒãŸå ´åˆ

## ğŸ“š è¿½åŠ ãƒªã‚½ãƒ¼ã‚¹

### é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [SECURITY.md](../SECURITY.md) - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å®Ÿè£…ã‚¬ã‚¤ãƒ‰
- [æ‰‹å‹•ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆæ‰‹é †æ›¸](../scripts/manual-security-test.md)
- [è¨­å®šã‚¬ã‚¤ãƒ‰](../docs/configuration.md)

### å¤–éƒ¨ãƒ„ãƒ¼ãƒ«
- [Security Headers](https://securityheaders.com/) - ãƒ˜ãƒƒãƒ€ãƒ¼ç¢ºèª
- [Mozilla Observatory](https://observatory.mozilla.org/) - ç·åˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯
- [OWASP ZAP](https://owasp.org/www-project-zap/) - è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å­¦ç¿’ãƒªã‚½ãƒ¼ã‚¹
- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [Web Security Cheat Sheet](https://cheatsheetseries.owasp.org/)
- [Node.js Security Checklist](https://blog.risingstack.com/node-js-security-checklist/)

---

å®šæœŸçš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œã«ã‚ˆã‚Šã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ™ãƒ«ã‚’ç¶­æŒã—ã€æ–°ãŸãªè„…å¨ã«å¯¾ã™ã‚‹é˜²å¾¡ã‚’å¼·åŒ–ã—ã¦ã„ãã¾ã™ã€‚